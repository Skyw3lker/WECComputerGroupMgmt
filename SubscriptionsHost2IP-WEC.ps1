$subscriptions = wecutil es;$computerNames = @();foreach ($subscription in $subscriptions) {$details = wecutil gr $subscription;$computerNames += ($details -split "`r`n" | Where-Object { $_ -match '^\t{2}\S+' }).Trim()};$scriptPath = Split-Path -Parent -Path $MyInvocation.MyCommand.Definition;$serversAndIps = Join-Path -Path $scriptPath -ChildPath "SubscriptionsIPz.csv";$results = @();$processedServers = @{};$totalServers = $computerNames.Count;$currentServer = 0;foreach ($server in $computerNames) {if ($processedServers.ContainsKey($server)) {continue};$currentServer++;$result = "" | Select ServerName, IPAddress;try {$addresses = [System.Net.Dns]::GetHostAddresses($server);foreach ($a in $addresses) {if ($a.AddressFamily -eq "InterNetwork") {$result.IPAddress = $a.IPAddressToString;$result.ServerName = $server}}} catch {$result.IPAddress = "NO IP Found";$result.ServerName = $server};if (!$result.IPAddress) {$result.IPAddress = "NO IP Found";$result.ServerName = $server};$results += $result;$processedServers.Add($server, $true)};$results | Export-Csv -NoTypeInformation $serversAndIps
